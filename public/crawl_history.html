<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ÌÅ¨Î°§ÎßÅ Ïù¥Î†•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .dark-mode {
            background-color: #333;
            color: #f8f9fa;
        }

        .container {
            width: 90%;
            margin: 2rem auto;
            background: white;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
        }

        .dark-mode .container {
            background: #444;
            color: #f8f9fa;
        }

        .container:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #007bff;
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .dark-mode h1 {
            color: #66b2ff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table, th, td {
            border: 1px solid #dee2e6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .dark-mode table, .dark-mode th, .dark-mode td {
            border: 1px solid #666;
        }

        th, td {
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            position: relative;
        }

        .dark-mode th {
            background-color: #0056b3;
        }

        th .sort-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0;
            margin-left: 10px;
        }

        .dark-mode th .sort-btn {
            color: #ccc;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .dark-mode tr:nth-child(even) {
            background-color: #555;
        }

        tr:nth-child(odd) {
            background-color: #fff;
        }

        .dark-mode tr:nth-child(odd) {
            background-color: #444;
        }

        button.delete-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button.delete-btn:hover {
            background-color: #c82333;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn-group button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-transform: uppercase;
            font-weight: bold;
        }

        .btn-group button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }

        .btn-group button.active {
            background-color: #004494;
        }

        @media (max-width: 768px) {
            .container {
                width: 100%;
                padding: 10px;
            }

            table, th, td {
                font-size: 0.875rem;
            }

            th, td {
                padding: 8px;
            }

            button.delete-btn {
                padding: 4px 8px;
            }

            h1 {
                font-size: 2rem;
            }

            .btn-group button {
                padding: 8px 16px;
            }
        }

        .fixed-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .fixed-buttons button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, color 0.3s, transform 0.3s;
        }

        .fixed-buttons .btn-primary:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        .dark-mode .fixed-buttons .btn-primary {
            background-color: #0056b3;
            color: #fff;
        }

        .dark-mode .fixed-buttons .dark-mode-toggle {
            background-color: #adb5bd;
            color: #333;
        }

        .fixed-buttons .dark-mode-toggle {
            background-color: #6c757d;
            color: white;
        }

        .fixed-buttons .dark-mode-toggle:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>ÌÅ¨Î°§ÎßÅ Ïù¥Î†•</h1>
        <div class="btn-group" id="requester-buttons">
            <!-- ÏöîÏ≤≠Ïûê Î≤ÑÌäºÏù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
        </div>
        <table id="crawlTable" class="table table-hover">
            <thead>
                <tr>
                    <th>ÌÇ§ÏõåÎìú<button class="sort-btn" onclick="sortTable('keyword')">üîΩ</button></th>
                    <th>ÏöîÏ≤≠Ïûê<button class="sort-btn" onclick="sortTable('name')">üîΩ</button></th>
                    <th>ÌÅ¨Î°§ÎßÅ ÎåÄÏÉÅ<button class="sort-btn" onclick="sortTable('crawl_object')">üîΩ</button></th>
                    <th>ÌÅ¨Î°§ÎßÅ ÏòµÏÖò<button class="sort-btn" onclick="sortTable('option_select')">üîΩ</button></th>
                    <th>ÏãúÏûëÏùº<button class="sort-btn" onclick="sortTable('start_day')">üîΩ</button></th>
                    <th>Ï¢ÖÎ£åÏùº<button class="sort-btn" onclick="sortTable('end_day')">üîΩ</button></th>
                    <th>ÏÇ≠Ï†ú</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="fixed-buttons">
        <button onclick="window.location.href='http://bigmaclab-crawler.kro.kr/history';" class="btn btn-primary">ÎåÄÏâ¨Î≥¥Îìú</button>
        <button onclick="window.location.href='http://bigmaclab-crawler.kro.kr';" class="btn btn-primary">ÌÅ¨Î°§Îü¨ Ï∂îÍ∞Ä</button>
        <button id="toggleDarkMode" onclick="toggleDarkMode()" class="btn dark-mode-toggle">Dark Mode</button>
    </div>

    <script>
        let allData = [];

        function getCrawlObjectName(crawl_object) {
            switch(crawl_object) {
                case '1': return 'Naver News';
                case '2': return 'Naver Blog';
                case '3': return 'Naver Cafe';
                case '4': return 'YouTube';
                case '5': return 'ChinaDaily';
                case '6': return 'ChinaSina';
                default: return 'Unknown';
            }
        }

        function getOptionName(CrawlObject, option) {
            switch(CrawlObject) {
                case '1':
                    switch(option) {
                        case '1': return 'Í∏∞ÏÇ¨ + ÎåìÍ∏Ä';
                        case '2': return 'Í∏∞ÏÇ¨ + ÎåìÍ∏Ä/ÎåÄÎåìÍ∏Ä';
                        default: return 'Unknown Option';
                    }
                case '2':
                    switch(option) {
                        case '1': return 'Î∏îÎ°úÍ∑∏ Î≥∏Î¨∏';
                        case '2': return 'Î∏îÎ°úÍ∑∏ Î≥∏Î¨∏ + ÎåìÍ∏Ä/ÎåÄÎåìÍ∏Ä';
                        default: return 'Unknown Option';
                    }
                case '3':
                    switch(option) {
                        case '1': return 'Ïπ¥Ìéò Î≥∏Î¨∏';
                        case '2': return 'Ïπ¥Ìéò Î≥∏Î¨∏ + ÎåìÍ∏Ä/ÎåÄÎåìÍ∏Ä';
                        default: return 'Unknown Option';
                    }
                case '4':
                    switch(option) {
                        case '1': return 'ÏòÅÏÉÅ Ï†ïÎ≥¥ + ÎåìÍ∏Ä/ÎåÄÎåìÍ∏Ä (100Í∞ú Ï†úÌïú)';
                        case '2': return 'ÏòÅÏÉÅ Ï†ïÎ≥¥ + ÎåìÍ∏Ä/ÎåÄÎåìÍ∏Ä (Î¨¥Ï†úÌïú)';
                        default: return 'Unknown Option';
                    }
                case '5':
                    switch(option) {
                        case '1': return 'Í∏∞ÏÇ¨';
                        default: return 'Unknown Option';
                    }
                case '6':
                    switch(option) {
                        case '1': return 'Í∏∞ÏÇ¨';
                        case '2': return 'Í∏∞ÏÇ¨ + ÎåìÍ∏Ä';
                        default: return 'Unknown Option';
                    }
                default: return 'Unknown CrawlObject';
            }
        }

        function createRequesterButtons() {
            const requesterNames = [...new Set(allData.map(data => data.name))];
            const buttonsContainer = document.getElementById('requester-buttons');

            requesterNames.forEach(name => {
                const button = document.createElement('button');
                button.textContent = name;
                button.onclick = () => {
                    document.querySelectorAll('.btn-group button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    showRequester(name);
                };
                buttonsContainer.appendChild(button);
            });
        }

        function showRequester(requesterName) {
            const tableBody = document.querySelector('#crawlTable tbody');
            tableBody.innerHTML = ''; // Í∏∞Ï°¥ ÎÇ¥Ïö© Ï†úÍ±∞
            const requesterData = allData.filter(data => data.name === requesterName);
            requesterData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.keyword}</td>
                    <td>${item.name}</td>
                    <td>${getCrawlObjectName(item.crawl_object)}</td>
                    <td>${getOptionName(item.crawl_object, item.option_select)}</td>
                    <td>${item.start_day}</td>
                    <td>${item.end_day}</td>
                    <td><button class='delete-btn' onclick="deleteRecord('${requesterName}', ${index})">ÏÇ≠Ï†ú</button></td>
                `;
                tableBody.appendChild(row);
            });
        }

        function deleteRecord(requesterName, filteredIndex) {
            if (confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) { // Confirmation dialog
                // Ïã§Ï†ú Ïù∏Îç±Ïä§Î•º Ï∞æÍ∏∞ ÏúÑÌï¥ ÌïÑÌÑ∞ÎßÅÎêú Îç∞Ïù¥ÌÑ∞Î•º ÏÇ¨Ïö©ÌïòÏó¨ Ïã§Ï†ú Ïù∏Îç±Ïä§Î•º Ï∞æÏïÑÏïº Ìï©ÎãàÎã§.
                const requesterData = allData.filter(data => data.name === requesterName);
                const itemToDelete = requesterData[filteredIndex];
        
                // Ïã§Ï†ú Ïù∏Îç±Ïä§Î•º Ï∞æÏäµÎãàÎã§.
                const actualIndex = allData.findIndex(data => data === itemToDelete);
                if (actualIndex !== -1) {
                    // ÏÑúÎ≤ÑÎ°ú DELETE ÏöîÏ≤≠ÏùÑ Î≥¥ÎÉÖÎãàÎã§.
                    fetch(`/deleteHistory?index=${actualIndex}`, { method: 'DELETE' })
                        .then(response => response.json())
                        .then(result => {
                            if (result.success) {
                                // Î∞∞Ïó¥ÏóêÏÑú Ìï≠Î™© Ï†úÍ±∞
                                allData.splice(actualIndex, 1);
                                // ÌòÑÏû¨ ÌôúÏÑ±ÌôîÎêú ÏöîÏ≤≠ÏûêÏùò Îç∞Ïù¥ÌÑ∞ Îã§Ïãú Î°úÎìú
                                showRequester(requesterName);
                            } else {
                                alert('Error deleting the record.');
                            }
                        })
                        .catch(error => {
                            console.error('Error deleting the record:', error);
                            alert('Error deleting the record.');
                        });
                } else {
                    alert('Error deleting the record.');
                }
            }
        }

        function sortTable(column) {
            allData.sort((a, b) => {
                let valA = a[column];
                let valB = b[column];

                if (typeof valA === 'string') {
                    valA = valA.toUpperCase();
                    valB = valB.toUpperCase();
                    if (valA < valB) return -1;
                    if (valA > valB) return 1;
                    return 0;
                } else if (typeof valA === 'number') {
                    return valA - valB;
                } else if (!isNaN(Date.parse(valA))) {
                    return new Date(valA) - new Date(valB);
                } else {
                    return 0;
                }
            });

            const activeButton = document.querySelector('.btn-group button.active');
            if (activeButton) {
                showRequester(activeButton.textContent);
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        document.addEventListener('DOMContentLoaded', function() {
            fetch('/getHistoryData')
                .then(response => response.json())
                .then(data => {
                    allData = data;
                    createRequesterButtons();
                })
                .catch(error => console.error('Error loading the data:', error));
        });
    </script>
</body>
</html>
